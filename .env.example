# =============================================================================
# VACATION PRICE TRACKER - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values
#
# MINIMUM REQUIRED VARIABLES:
# ---------------------------
# The following variables MUST be configured to run the application:
#   - DATABASE_URL (pre-configured for Docker Compose)
#   - REDIS_URL (pre-configured for Docker Compose)
#   - GOOGLE_CLIENT_ID / GOOGLE_CLIENT_SECRET (from Google Cloud Console)
#   - SECRET_KEY (generate with: openssl rand -hex 32)
#   - AMADEUS_API_KEY / AMADEUS_API_SECRET (from developers.amadeus.com)
#   - GROQ_API_KEY (from console.groq.com)
#
# Quick start:
#   1. cp .env.example .env
#   2. Generate SECRET_KEY: openssl rand -hex 32
#   3. Set up Google OAuth credentials
#   4. Set up Amadeus API credentials
#   5. Set up Groq API key
#   6. Run: ./scripts/dev.sh

# --- CORE APP CONFIG ---
PROJECT_NAME="Vacation Price Tracker"
ENVIRONMENT=development  # development | production
FRONTEND_URL=https://localhost:3000
BACKEND_URL=https://localhost:8000
# Comma-separated list of allowed origins for CORS.
# In production, set this to your single Vercel domain (or custom domain) only.
# Example: CORS_ALLOWED_ORIGINS=https://your-app.vercel.app
CORS_ALLOWED_ORIGINS=
SECRET_KEY=generate-a-random-secret-key-here

# --- AUTH (GOOGLE OAUTH) ---
# Get these from Google Cloud Console -> Credentials
# https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret

# --- DATABASE ---
# For Docker Compose setup
DATABASE_URL=postgresql+asyncpg://postgres:postgres@db:5432/vacation_tracker

# --- LLM & AI (GROQ) ---
# Get from https://console.groq.com (Free tier available)
GROQ_API_KEY=gsk_your_api_key_here
GROQ_MODEL=llama-3.3-70b-versatile

# =============================================================================
# EXTERNAL FLIGHT & HOTEL PROVIDERS
# =============================================================================

# --- AMADEUS API (Detailed Flights & Hotels) ---
# Get credentials from https://developers.amadeus.com
# Free tier: ~2,000 calls/month (shared between flights and hotels)
# Used for: flight numbers, segment details, airline filtering, hotel searches
AMADEUS_API_KEY=your_amadeus_api_key
AMADEUS_API_SECRET=your_amadeus_api_secret
# IMPORTANT: Default is TEST API which returns synthetic data with fake schedules!
# Set to production URL for real flight times (requires production API keys):
# AMADEUS_BASE_URL=https://api.amadeus.com
AMADEUS_BASE_URL=https://test.api.amadeus.com
MOCK_AMADEUS_API=false

# --- EXTERNAL FLIGHT PRICE PROVIDER ---
# Options: "amadeus" (default), "fast-flights" (Google Flights scraper)
# - amadeus: Uses Amadeus Flight Offers Search API (2,000 calls/month free tier)
# - fast-flights: Uses Google Flights via open-source scraper (FREE, unlimited)
EXTERNAL_FLIGHT_PRICE_PROVIDER=amadeus

# fast-flights fetch mode (only applies when EXTERNAL_FLIGHT_PRICE_PROVIDER=fast-flights)
# Options:
#   - "common": Direct HTTP requests (your server IP is exposed to Google)
#   - "fallback": Tries direct first, falls back to local Playwright if blocked
#   - "local": Uses local Playwright installation (requires playwright in container)
# WARNING: "force-fallback" (serverless Playwright) is currently broken upstream.
# The try.playwright.tech service now requires authentication tokens.
# See: https://github.com/AWeirdDev/flights/issues/53
FAST_FLIGHTS_FETCH_MODE=common

# =============================================================================
# MCP SERVERS (Model Context Protocol)
# =============================================================================
# MCP servers run as stdio subprocesses for hotel/flight data
# These defaults work for Docker; adjust paths for local development if needed.
MCP_NODE_PATH=node
AMADEUS_MCP_PATH=node_modules/@modelcontextprotocol/server-amadeus-travel/dist/index.js
MCP_TIMEOUT_SECONDS=30
MCP_MAX_RESTART_ATTEMPTS=3

# =============================================================================
# FLEXIBLE DATE OPTIMIZER (Optional - Phase 4)
# =============================================================================

# --- SEARCHAPI (Google Hotels scraping) ---
# Get from https://www.searchapi.io
# Pricing: $40/month for 10,000 searches (Developer plan)
# Used for: Bulk date-range price surveying
SEARCHAPI_KEY=your_searchapi_key

# Optimizer settings
OPTIMIZER_MAX_DATE_RANGE_DAYS=90
# 20% of 10K plan
OPTIMIZER_RATE_LIMIT_PER_HOUR=2000

# =============================================================================
# TEMPORAL (Workflow Orchestration)
# =============================================================================
TEMPORAL_ADDRESS=temporal:7233
TEMPORAL_NAMESPACE=default
TEMPORAL_TASK_QUEUE=vacation-tracker-tasks

# =============================================================================
# NOTIFICATIONS
# =============================================================================

# --- EMAIL (SMTP2GO) ---
# Get credentials from https://www.smtp2go.com
# Free tier: 1,000 emails/month
SMTP_HOST=smtp.smtp2go.com
SMTP_PORT=587
SMTP_USER=your_smtp_username
SMTP_PASS=your_smtp_password
EMAIL_FROM=notifications@yourdomain.com

# --- SMS (Optional) ---
# https://www.notificationapi.com/
NOTIFICATION_API_KEY=optional_key_for_sms

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Set to 'false' in dev to disable real SMS sending
ENABLE_SMS_NOTIFICATIONS=false

# Controls whether the flexible date optimizer is visible in the UI
# Set to 'true' only after configuring SEARCHAPI_KEY
ENABLE_BETA_OPTIMIZER=false

# Max number of trips a user can track
MAX_TRIPS_PER_USER=10

# Refresh frequency (for rate limit management)
# Options: daily, every_3_days, weekly
DEFAULT_REFRESH_FREQUENCY=daily

# =============================================================================
# RATE LIMITING
# =============================================================================

# Max requests per minute per user (or IP if unauthenticated)
RATE_LIMIT_PER_MINUTE=100

# Max chat messages per minute per user (LLM calls are expensive)
CHAT_RATE_LIMIT_PER_MINUTE=10

# =============================================================================
# CACHING (Redis)
# =============================================================================

# Redis URL for caching API responses, rate limiting, and session data
REDIS_URL=redis://redis:6379/0

# Cache TTL for hotel/flight searches (seconds)
# 24 hours = 86400
CACHE_TTL_SECONDS=86400

# =============================================================================
# OBSERVABILITY (Optional)
# =============================================================================

# OpenTelemetry endpoint for distributed tracing
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
LOG_LEVEL=INFO
