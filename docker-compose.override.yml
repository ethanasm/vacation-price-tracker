# Development overrides - automatically loaded by docker-compose
# Provides hot-reload for all application services

services:
  api:
    build:
      target: development
    volumes:
      - .:/app
      - /app/.venv  # Exclude virtualenv from mount
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
      - DEBUG=1  # Connect to PyCharm's debug server on port 5678
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

  worker:
    build:
      target: development
    volumes:
      - .:/app
      - /app/.venv  # Exclude virtualenv from mount
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
    command: ["sh", "-c", "pip install watchfiles && watchfiles --filter python 'python -m worker' /app/apps/worker /app/apps/api/app"]

  web:
    build:
      target: development
    volumes:
      - ./apps/web:/app
      - /app/node_modules  # Exclude node_modules from mount
      - /app/.next  # Exclude .next build cache from mount
    environment:
      - NODE_ENV=development
      - CI=true
    command: ["sh", "-c", "pnpm install --no-frozen-lockfile --force && pnpm run dev"]
